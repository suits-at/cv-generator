<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CV Generator</title>
  <!--chart.js-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
  <!--googe charts-->
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <!--html2canvas-->
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <!-- fontawesome-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <!--google fonts-->
  <link href="https://fonts.googleapis.com/css?family=Work+Sans" rel="stylesheet">
  <style>
    html {
      font-family: 'Work Sans', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif;
      color: #444;

      /* enable smoother fonts */
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    #container{
      width: 1060px;
    }
    #legend p{
      font-size: 16px;
      font-weight: bold;
      margin-top: 5px;
    }
    .fa {
      font-size: 3rem;
    }
    #digital{
      display: grid;
      grid-template-columns: 3fr 7fr;
      grid-gap: 10vmin;
    }
    #proficiencyLevel{
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
    }
    #proficiencyLevel p{
      margin-bottom: 7px;
    }
    #legend{
      text-align: right;
    }
  </style>
</head>
<body>
<div id="container">
<h1>Schul- und Berufsausbildung / Berufserfahrung</h1>
<div id="timeline" style="height: 500px;"></div>
<div id="canvas-holder" style="width:50%">
  <h1>Sprachkenntnisse</h1>
  <canvas id="chart-area1"></canvas>
  <canvas id="chart-area2"></canvas>
</div>

<h1>Digitale Kompetenzen</h1>
<div id="digital">
  <div id="legend">
  <div class="star">
    <i class="fa fa-star" aria-hidden="true"></i>
    <i class="fa fa-star-o" aria-hidden="true"></i>
    <i class="fa fa-star-o" aria-hidden="true"></i>
    <p>elementare Verwendung</p>
  </div>
  <div class="star">
    <i class="fa fa-star" aria-hidden="true"></i>
    <i class="fa fa-star" aria-hidden="true"></i>
    <i class="fa fa-star-o" aria-hidden="true"></i>
    <p>selbstständige Verwendung</p>
  </div>
  <div class="star">
    <i class="fa fa-star" aria-hidden="true"></i>
    <i class="fa fa-star" aria-hidden="true"></i>
    <i class="fa fa-star" aria-hidden="true"></i>
    <p>kompetente Verwendung</p>
  </div>
  </div>
  <div id="proficiencyLevel">
    <div class="star" id="information"></div>
    <div class="star" id="communication"></div>
    <div class="star" id="contentcreation"></div>
    <div class="star" id="safety"></div>
    <div class="star" id="problemsolving"></div>
  </div>
</div>
<!--<button id="download">download Images</button>-->
</div>
<!--read data from xml-->
<script>
  let languageDataLabel = [];
  let languageData = [];
  let jobData = [];
  let colorCounter = [];
  const xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function() {
    if (this.readyState === 4 && this.status === 200) {
      const doc = xhr.responseXML;
      const cv = getJXONTree(doc);

      //read languages
      const languages = cv.skillspassport.learnerinfo.skills.linguistic.foreignlanguagelist.foreignlanguage;
      for (i = 0; i < languages.length; i++) {
        languageDataLabel.push(languages[i].description.label);
        languageData.push(languages[i].proficiencylevel);
      }
      drawRoseChart();

      //read workexperience
      const jobs = cv.skillspassport.learnerinfo.workexperiencelist.workexperience;
      colorCounter['jobs'] = jobs.length;
      for (let i = 0; i < jobs.length; i++) {
        let fromYear = jobs[i].period.from["@year"];
        let fromMonth = jobs[i].period.from["@month"].toString();
        fromMonth = fromMonth.split(" ");
        fromMonth = fromMonth[2];
        let fromDate = new Date(fromYear, fromMonth);

        let toDate = new Date();
        if (jobs[i].period.to !== undefined){
          let toYear = jobs[i].period.to["@year"];
          let toMonth = jobs[i].period.to["@month"].toString();
          toMonth = toMonth.split(" ");
          toMonth = toMonth[2];
          toDate = new Date(toYear, toMonth);
        }
        jobData[i] = [];
        let label = 'Berufserfahrung';
        if (i !== 0){
          label = '.';
        }
        jobData[i].push(label, jobs[i].position.label + ', ' + jobs[i].employer.name.toString(), fromDate, toDate);
      }
      // read education
      const education = cv.skillspassport.learnerinfo.educationlist.education;
      colorCounter['education'] = education.length;
      for (let i = 0; i < education.length; i++) {
        let fromYear = education[i].period.from["@year"];
        let fromMonth = education[i].period.from["@month"].toString();
        fromMonth = fromMonth.split(" ");
        fromMonth = fromMonth[2];
        let fromDate = new Date(fromYear, fromMonth);

        let toDate = new Date();
        if (education[i].period.to !== undefined){
          let toYear = education[i].period.to["@year"];
          let toMonth = education[i].period.to["@month"].toString();
          toMonth = toMonth.split(" ");
          toMonth = toMonth[2];
          toDate = new Date(toYear, toMonth);
        }
        jobData[i+jobs.length] = [];
        let label = 'Schul- und Berufssbildung';
        if (i !== 0){
          label = '.';
        }
        jobData[i+jobs.length].push(label, education[i].title + ', ' + education[i].organisation.name.toString(), fromDate, toDate);
      }

      // read digital competences
      const digital = cv.skillspassport.learnerinfo.skills.computer.proficiencylevel;

      let oneStar = '<i class="fa fa-star" aria-hidden="true"></i><i class="fa fa-star-o" aria-hidden="true"></i><i class="fa fa-star-o" aria-hidden="true"></i>';
      let twoStar = '<i class="fa fa-star" aria-hidden="true"></i><i class="fa fa-star" aria-hidden="true"></i><i class="fa fa-star-o" aria-hidden="true"></i>';
      let threeStar = '<i class="fa fa-star" aria-hidden="true"></i><i class="fa fa-star" aria-hidden="true"></i><i class="fa fa-star" aria-hidden="true"></i>';
      let el;
      let p;


      el = document.getElementById('information');
      p = '<p>Datenverarbeitung</p>';
      if(digital.information === 'A'){
        el.innerHTML = p + oneStar;
      } else if (digital.information === 'B') {
        el.innerHTML = p + twoStar;
      } else if (digital.information === 'C') {
        el.innerHTML = p + threeStar;
      }

      el = document.getElementById('communication');
      p = '<p>Kommunikation</p>';
      if(digital.communication === 'A'){
        console.log('yes!');
        el.innerHTML = p + oneStar;
        console.log(el);
      } else if (digital.communication === 'B') {
        el.innerHTML = p + twoStar;
      } else if (digital.communication === 'C') {
        el.innerHTML = p + threeStar;
      }

      el = document.getElementById('contentcreation');
      p = '<p>Erstellung von Inhalten</p>';
      if(digital.contentcreation === 'A'){
        el.innerHTML = p + oneStar;
      } else if (digital.contentcreation === 'B') {
        elinnerHTML = p + twoStar;
      } else if (digital.contentcreation === 'C') {
        el.innerHTML = p + threeStar;
      }

      el = document.getElementById('safety');
      p = '<p>Sicherheit</p>';
      if(digital.safety === 'A'){
        el.innerHTML = p + oneStar;
      } else if (digital.safety === 'B') {
        el.innerHTML = p + twoStar;
      } else if (digital.safety === 'C') {
        el.innerHTML = p + threeStar;
      }

      el = document.getElementById('problemsolving');
      p = '<p>Problemlösung</p>';
      if(digital.problemsolving === 'A'){
        el.innerHTML = p + oneStar;
      } else if (digital.problemsolving === 'B') {
        el.innerHTML = p + twoStar;
      } else if (digital.problemsolving === 'C') {
        el.innerHTML = p + threeStar;
      }
    }
  };
  xhr.open("GET", "data/cv.xml", true);
  xhr.send();

/*\
|*|
|*|  JXON Snippet #3 - Mozilla Developer Network
|*|
|*|  https://developer.mozilla.org/en-US/docs/JXON
|*|  https://developer.mozilla.org/User:fusionchess
|*|
|*|  This framework is released under the GNU Public License, version 3 or later.
|*|  http://www.gnu.org/licenses/gpl-3.0-standalone.html
|*|
\*/
  function parseText (sValue) {
    if (/^\s*$/.test(sValue)) { return null; }
    if (/^(?:true|false)$/i.test(sValue)) { return sValue.toLowerCase() === "true"; }
    if (isFinite(sValue)) { return parseFloat(sValue); }
    if (isFinite(Date.parse(sValue))) { return new Date(sValue); }
    return sValue;
  }
  function getJXONTree (oXMLParent) {
    let vResult = /* put here the default value for empty nodes! */ true, nLength = 0, sCollectedTxt = "";
    if (oXMLParent.hasAttributes && oXMLParent.hasAttributes()) {
      vResult = {};
      for (nLength; nLength < oXMLParent.attributes.length; nLength++) {
        oAttrib = oXMLParent.attributes.item(nLength);
        vResult["@" + oAttrib.name.toLowerCase()] = parseText(oAttrib.value.trim());
      }
    }
    if (oXMLParent.hasChildNodes()) {
      for (let oNode, sProp, vContent, nItem = 0; nItem < oXMLParent.childNodes.length; nItem++) {
        oNode = oXMLParent.childNodes.item(nItem);
        if (oNode.nodeType === 4) { sCollectedTxt += oNode.nodeValue; } /* nodeType is "CDATASection" (4) */
        else if (oNode.nodeType === 3) { sCollectedTxt += oNode.nodeValue.trim(); } /* nodeType is "Text" (3) */
        else if (oNode.nodeType === 1 && !oNode.prefix) { /* nodeType is "Element" (1) */
          if (nLength === 0) { vResult = {}; }
          sProp = oNode.nodeName.toLowerCase();
          vContent = getJXONTree(oNode);
          if (vResult.hasOwnProperty(sProp)) {
            if (vResult[sProp].constructor !== Array) { vResult[sProp] = [vResult[sProp]]; }
            vResult[sProp].push(vContent);
          } else { vResult[sProp] = vContent; nLength++; }
        }
      }
    }
    if (sCollectedTxt) { nLength > 0 ? vResult.keyValue = parseText(sCollectedTxt) : vResult = parseText(sCollectedTxt); }
    if (nLength > 0) { Object.freeze(vResult); }
    return vResult;
  }

<!--chart.js rose chart-->
  function drawRoseChart() {
    window.chartColors = {
      color1: '#f0f9e8',
      color2: '#bae4bc',
      color3: '#7bccc4',
      color4: '#43a2ca',
      color5: '#0868ac',
    };
    const chartColors = window.chartColors;
    const color = Chart.helpers.color;
    Chart.defaults.global.defaultFontColor = '#444';
    Chart.defaults.global.defaultFontFamily = "'Work Sans', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif";
    Chart.defaults.global.defaultFontSize = 14;

    let config = [];
    for(i=0; i<languageDataLabel.length;i++){

      let myData = [];
      for (const value in languageData[i]) {
        switch(languageData[i][value]) {
          case "A1":
            myData.push(1);
            break;
          case "A2":
            myData.push(2);
            break;
          case "B1":
            myData.push(3);
            break;
          case "B2":
            myData.push(4);
            break;
          case "C1":
            myData.push(5);
            break;
          case "C2":
            myData.push(6);
            break;
        }
      }

      config[i] = {
      data: {
        datasets: [{
          data: myData,
          backgroundColor: [
            color(chartColors.color1).alpha(0.6).rgbString(),
            color(chartColors.color2).alpha(0.8).rgbString(),
            color(chartColors.color3).alpha(0.8).rgbString(),
            color(chartColors.color4).alpha(0.8).rgbString(),
            color(chartColors.color5).alpha(0.8).rgbString(),
          ],
        }],
        labels: [
          "Hören",
          "Lesen",
          "An Gesprächen teilnehmen",
          "Zusammenhängendes Sprechen",
          "Schreiben"
        ]
      },
      options: {
        responsive: true,
        legend: {
          position: 'left',
        },
        title: {
          display: true,
          text: languageDataLabel[i]
        },
        tooltips: {
          enabled: false
        },
        //change start angle for better legibility
        startAngle: 1.3 * Math.PI,
        scale: {
          ticks: {
            beginAtZero: false,
            min: 0,
            max: 6,
            maxTicksLimit: 6,
            suggestedMin: 6,
            suggestedMax: 6,
            stepSize: 1,
            //change labeling
            callback: function(label) {
              switch (label) {
                case 1:
                  return 'A1';
                case 2:
                  return 'A2';
                case 3:
                  return 'B1';
                case 4:
                  return 'B2';
                case 5:
                  return 'C1';
                case 6:
                  return 'C2';
              }
            }
          },
          reverse: false
        },
        animation: {
          animateRotate: true,
          animateScale: true
        }
      }
    };
    }
    window.onload = function() {
      const chart1 = document.getElementById("chart-area1");
      const chart2 = document.getElementById("chart-area2");
      window.myPolarArea = Chart.PolarArea(chart1, config[0]);
      // Chart.defaults.global.legend.display = false;
      window.myPolarArea = Chart.PolarArea(chart2, config[1]);
    };

  }

<!--google charts timeline-->
  google.charts.load("current", {packages: ["timeline"]});
  google.charts.setOnLoadCallback(drawChart);

  function drawChart() {
    const container = document.getElementById('timeline');
    const chart = new google.visualization.Timeline(container);
    const dataTable = new google.visualization.DataTable();
    dataTable.addColumn({type: 'string', id: 'Position'});
    dataTable.addColumn({type: 'string', id: 'Name'});
    dataTable.addColumn({type: 'date', id: 'Start'});
    dataTable.addColumn({type: 'date', id: 'End'});
    dataTable.addRows(jobData);

    //define colors for each group of data
    const color1 = '#deebf7';
    const color2 = '#9ecae1';
    let colors = [];

    //add colors for jobs
    for (let i = 0; i < colorCounter['jobs']; i++){
      colors.push(color1);
    }

    //add colors for education
    for (let i = 0; i < colorCounter['education']; i++){
      colors.push(color2);
    }

    const options = {
      timeline: {
        groupByRowLabel: false,
        colorByRowLabel: false,
        showRowLabels: true,
        rowLabelStyle: {
          fontName: "'Work Sans', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",
          color: '#444',
          fontSize: 14
        },
        barLabelStyle: {
          fontName: "'Work Sans', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",
          color: '#444',
          fontSize: 14
        }
      },
      colors: colors,
    };
    chart.draw(dataTable, options);
  }

<!--createImage from timeline and proficiencyLevel-->
  //document ready
  function r(f){/in/.test(document.readyState)?setTimeout('r('+f+')',9):f()}
  r(function(){
    //convert timeline to image
    // html2canvas(document.querySelector("#timeline")).then(canvas => {
    //   const item = document.querySelector("#timeline");
    //   item.innerHTML = '';
    //   item.appendChild(canvas);
    // });

    //convert proficiencyLevel to image
    html2canvas(document.querySelector("#digital")).then(canvas => {
      const item = document.querySelector("#digital");
      item.innerHTML = '';
      item.appendChild(canvas);
    });
  });

</script>
</body>
</html>
